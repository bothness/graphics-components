{"version":3,"file":"AnalyticsBanner.stories-cae30e22.js","sources":["../../src/layout/AnalyticsBanner/docs/component.md?raw","../../src/layout/AnalyticsBanner/AnalyticsBanner.svelte","../../src/layout/AnalyticsBanner/AnalyticsBanner.stories.svelte"],"sourcesContent":["export default \"This component will display a cookie banner and export a function that allows you to push events to the Google Analytics dataLayer array.\\n\\n<!-- prettier-ignore -->\\n```html\\n<script>\\n  import { AnalyticsBanner, AnalyticsEvent } from \\\"@onsvisual/svelte-components\\\";\\n\\n  // Example of an analytics event triggered by another event \\\"e\\\"\\n  function doAnalyticsEvent(e) {\\n    // Assumes that e.detail is in the form {key1: \\\"value1\\\", key2: \\\"value2\\\", etc}\\n    AnalyticsEvent({event: \\\"eventName\\\", ...e.detail});\\n  }\\n</script>\\n\\n<AnalyticsBanner analyticsId=\\\"{id_string}\\\" />\\n<!-- Rest of page content -->\\n```\\n\"","<script context=\"module\">\n  export function analyticsEvent(props) {\n    if (window?.dataLayer) window.dataLayer.push(props);\n  }\n</script>\n\n<script>\n  import { onMount, getContext } from \"svelte\";\n\n  const page = getContext(\"page\"); // Optional: Set Svelte Kit's page store to the context to track navigation in multi-page apps\n\n  /**\n   * Google analytics/tags manager ID\n   * @type {string}\n   */\n  export let analyticsId = \"GTM-MBCBVQS\";\n  /**\n   * Optional props to describe the content\n   * @type {object}\n   */\n  export let analyticsProps = {};\n  /**\n   * Bind to this value if you need to know if cookies have been accepted\n   * @type {boolean}\n   */\n  export let usageCookies = false;\n  /**\n   * Set the width of the banner\n   * @type {\"medium\"|\"wide\"}\n   */\n  export let width = \"medium\";\n\n  let live; // Don't run analytics unless page is live on ONS site (re-set in the onMount function)\n  let showBanner = false;\n  let showConfirm = false;\n  let message = \"\";\n  let lang = $page && $page.url.host.startsWith(\"cy\") ? \"cy\" : \"en\";\n  let location = null; // For keeping track of navigation multi-page apps\n\n  function hasCookiesPreferencesSet() {\n    return -1 < document.cookie.indexOf(\"cookies_preferences_set=true\");\n  }\n\n  // Check if usage cookies are allowed (for Google Analytics + Hotjar)\n  function getUsageCookieValue() {\n    var cookiesPolicyCookie = document.cookie.match(\n      new RegExp(\"(^|;) ?cookies_policy=([^;]*)(;|$)\")\n    );\n    if (cookiesPolicyCookie) {\n      var decodedCookie = decodeURIComponent(cookiesPolicyCookie[2]);\n      var cookieValue = JSON.parse(decodedCookie);\n      return cookieValue.usage;\n    }\n    return false;\n  }\n\n  // Set site cookie with 'all' or 'essential' cookies\n  function setCookie(option) {\n    let oneYearInSeconds = 60 * 60 * 24 * 365;\n    let cookiesDomain = window.location.hostname;\n    let cookiesPreference = !0;\n    let encodedCookiesPolicy = `%7B%22essential%22%3Atrue%2C%22usage%22%3A${\n      option == \"all\" ? \"true\" : \"false\"\n    }%7D`;\n    let cookiesPath = \"/\";\n\n    document.cookie = `cookies_preferences_set=${cookiesPreference};max-age=${oneYearInSeconds};domain=${cookiesDomain};path=${cookiesPath};`;\n    document.cookie = `cookies_policy=${encodedCookiesPolicy};max-age=${oneYearInSeconds};domain=${cookiesDomain};path=${cookiesPath};`;\n\n    message = `You have ${option == \"all\" ? \"accepted\" : \"rejected\"} all additional cookies.`;\n    if (option == \"all\") usageCookies = true;\n    showConfirm = true;\n\n    if (option == \"all\") initAnalytics();\n  }\n\n  // Initialise analytics and 'window.dataLayer' (which can be used throughout the app)\n  function initAnalytics() {\n    console.log(\"initialising analytics\");\n    window.dataLayer = [\n      {\n        analyticsOptOut: false,\n        \"gtm.whitelist\": [\"google\", \"hjtc\", \"lcl\"],\n        \"gtm.blacklist\": [\"customScripts\", \"sp\", \"adm\", \"awct\", \"k\", \"d\", \"j\"],\n        ...analyticsProps,\n      },\n    ];\n\n    (function (w, d, s, l, i) {\n      w[l] = w[l] || [];\n      w[l].push({ \"gtm.start\": new Date().getTime(), event: \"gtm.js\" });\n      var f = d.head,\n        j = d.createElement(s),\n        dl = l != \"dataLayer\" ? \"&l=\" + l : \"\";\n      j.async = true;\n      j.src = \"https://www.googletagmanager.com/gtm.js?id=\" + i + dl;\n      f.appendChild(j);\n    })(window, document, \"script\", \"dataLayer\", analyticsId);\n\n    if ($page) location = `${$page.url.href}`.replace($page.url.hash, \"\");\n  }\n\n  // This code is only relevant for multi-page Svelte Kit apps. It sends an analytics event when the URL changes\n  function onPageChange(page) {\n    if (page && location) {\n      const newlocation = `${page.url.href}`.replace(page.url.hash, \"\");\n      if (newlocation !== location) {\n        location = newlocation;\n        analyticsEvent({\n          event: \"pageView\",\n          pageURL: location,\n          ...analyticsProps,\n        });\n      }\n    }\n  }\n  $: onPageChange($page);\n\n  onMount(() => {\n    live = true;\n    //live = document.location.hostname == \"www.ons.gov.uk\" || document.location.hostname == \"cy.ons.gov.uk\";\n    if (!page) lang = document.location.host.startsWith(\"cy\") ? \"cy\" : \"en\";\n    showBanner = !hasCookiesPreferencesSet();\n    usageCookies = getUsageCookieValue();\n    if (usageCookies && live) initAnalytics();\n  });\n\n  const texts = {\n    \"Cookies on ons.gov.uk\": \"Cwcis ar ons.gov.uk\",\n    \"Cookies are small files stored on your device when you visit a website. We use some essential cookies to make this website work.\":\n      \"Ffeiliau bach a gaiff eu storio ar eich dyfais pan fyddwch yn mynd ar wefan yw cwcis. Rydym ni’n defnyddio rhai cwcis hanfodol i wneud i’r wefan hon weithio.\",\n    \"We would like to set\": \"Hoffem osod\",\n    \"additional cookies\": \"cwcis ychwanegol\",\n    \"to remember your settings and understand how you use the site. This helps us to improve our services.\":\n      \"er mwyn cofio eich gosodiadau a deall sut rydych chi’n defnyddio’r wefan. Mae hyn yn ein helpu ni i wella ein gwasanaethau.\",\n    \"Accept additional cookies\": \"Derbyn cwcis ychwanegol\",\n    \"Reject additional cookies\": \"Gwrthod cwcis ychwanegol\",\n    \"View cookies\": \"Gweld cwcis\",\n    \"You have accepted all additional cookies.\": \"Rydych chi wedi derbyn yr holl gwcis ychwanegol.\",\n    \"You have rejected all additional cookies.\":\n      \"Rydych chi wedi gwrthod yr holl gwcis ychwanegol.\",\n    \"You can\": \"Gallwch chi\",\n    \"change your cookie preferences\": \"newid eich dewisiadau o ran cwcis\",\n    \"at any time.\": \"ar unrhyw adeg.\",\n    Hide: \"Cuddio\",\n  };\n  const i18n = (text) => (lang == \"cy\" && texts[text] ? texts[text] : text);\n</script>\n\n{#if showBanner}\n  <div\n    class=\"ons-cookies-banner\"\n    role=\"region\"\n    aria-label=\"Cookies banner\"\n    style:display=\"{showBanner ? \"block\" : null}\"\n  >\n    {#if !showConfirm}\n      <form\n        action=\"/cookies/accept-all\"\n        method=\"GET\"\n        id=\"global-cookie-message\"\n        aria-label=\"cookie banner\"\n      >\n        <div\n          class=\"ons-container ons-cookies-banner__primary\"\n          class:ons-page__container--wide=\"{width === 'wide'}\"\n        >\n          <div class=\"ons-grid\">\n            <div class=\"ons-grid__col ons-col-8@m\">\n              <h2 class=\"ons-cookies-banner__title ons-u-mb-xs\">{i18n(\"Cookies on ons.gov.uk\")}</h2>\n              <div class=\"ons-cookies-banner__statement\">\n                <p>\n                  {i18n(\n                    \"Cookies are small files stored on your device when you visit a website. We use some essential cookies to make this website work.\"\n                  )}\n                </p>\n                <p>\n                  {i18n(\"We would like to set\")} <a href=\"/cookies\">{i18n(\"additional cookies\")}</a>\n                  {i18n(\n                    \"to remember your settings and understand how you use the site. This helps us to improve our services.\"\n                  )}\n                </p>\n              </div>\n            </div>\n          </div>\n          <div class=\"ons-grid ons-grid--flex ons-u-mt-s\">\n            <div class=\"ons-grid__col\">\n              <button\n                type=\"submit\"\n                class=\"ons-btn ons-btn--small ons-js-accept-cookies ons-cookies-banner__btn\"\n                data-button=\"accept\"\n                on:click|preventDefault=\"{() => setCookie('all')}\"\n              >\n                <span class=\"ons-btn__inner\"\n                  ><span class=\"ons-btn__text\">{i18n(\"Accept additional cookies\")}</span>\n                </span>\n              </button>\n            </div>\n            <div class=\"ons-grid__col\">\n              <button\n                type=\"button\"\n                class=\"ons-btn ons-btn--small ons-js-reject-cookies ons-cookies-banner__btn\"\n                data-button=\"reject\"\n                on:click|preventDefault=\"{() => setCookie('reject')}\"\n              >\n                <span class=\"ons-btn__inner\"\n                  ><span class=\"ons-btn__text\">{i18n(\"Reject additional cookies\")}</span>\n                </span>\n              </button>\n            </div>\n            <div class=\"ons-grid__col\">\n              <a class=\"ons-cookies-banner__link\" href=\"/cookies\">{i18n(\"View cookies\")}</a>\n            </div>\n          </div>\n        </div>\n      </form>\n    {:else}\n      <div\n        class=\"ons-container ons-cookies-banner__confirmation\"\n        class:ons-page__container--wide=\"{width === 'wide'}\"\n      >\n        <div\n          class=\"ons-grid ons-grid--flex ons-grid--between ons-grid--gutterless ons-grid--no-wrap@s ons-grid--vertical-center\"\n        >\n          <div class=\"ons-grid__col ons-grid__col--flex ons-col-auto ons-u-flex-shrink@s\">\n            <p class=\"ons-cookies-banner__desc ons-u-mb-no@s ons-u-mr-s@s\">\n              <span>{i18n(message)}</span>\n              <span class=\"ons-cookies-banner__preferences-text\"\n                >{i18n(\"You can\")} <a href=\"/cookies\">{i18n(\"change your cookie preferences\")}</a>\n                {i18n(\"at any time\")}.</span\n              >\n            </p>\n          </div>\n          <div class=\"ons-grid__col\">\n            <button\n              type=\"button\"\n              class=\"ons-btn ons-btn--secondary ons-btn--small ons-js-hide-button\"\n              on:click=\"{() => (showBanner = false)}\"\n            >\n              <span class=\"ons-btn__inner\"><span class=\"ons-btn__text\">{i18n(\"Hide\")}</span> </span>\n            </button>\n          </div>\n        </div>\n      </div>\n    {/if}\n  </div>\n{/if}\n\n<style>\n  .ons-cookies-banner {\n    /* padding: 0; */\n    background: none !important;\n  }\n  .ons-page__container--wide {\n    max-width: 1240px;\n  }\n</style>\n","<script>\n  import { Meta, Template, Story } from \"@storybook/addon-svelte-csf\";\n\n  // @ts-ignore\n  import componentDocs from \"./docs/component.md?raw\";\n  import AnalyticsBanner from \"./AnalyticsBanner.svelte\";\n  import { withComponentDocs } from \"../../js/withParams.js\";\n</script>\n\n<Meta\n  title=\"Layout/AnalyticsBanner\"\n  component=\"{AnalyticsBanner}\"\n  argTypes=\"{{}}\"\n  {...withComponentDocs(componentDocs)}\n/>\n\n<Template let:args>\n  <AnalyticsBanner {...args} />\n</Template>\n\n<Story name=\"Default\" args=\"{{}}\" />\n"],"names":["componentDocs","ctx","create_if_block_1","insert","target","div","anchor","t0_value","t2_value","t6_value","a","span2","toggle_class","div3","append","div2","div0","p","span0","span1","div1","button","span3","dirty","set_data","t0","t4_value","t8_value","h2","p0","a0","a1","div7","form","p1","div6","button0","div4","button1","div5","create_if_block","analyticsEvent","props","hasCookiesPreferencesSet","getUsageCookieValue","cookiesPolicyCookie","decodedCookie","cookieValue","page","getContext","analyticsId","$$props","analyticsProps","usageCookies","width","live","showBanner","showConfirm","message","lang","$page","location","setCookie","option","oneYearInSeconds","cookiesDomain","cookiesPreference","encodedCookiesPolicy","cookiesPath","$$invalidate","initAnalytics","w","d","s","l","i","f","j","dl","onPageChange","newlocation","onMount","texts","i18n","text","click_handler","click_handler_1","click_handler_2","AnalyticsBanner","withComponentDocs","get_spread_object"],"mappings":"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"}